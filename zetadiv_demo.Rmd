---
title: "zetadiv_demo"
author: "Jacob Nesslage"
date: "2023-08-10"
output: html_document
---

```{r install zetadiv,eval=F}
install.packages("zetadiv")
```

```{r}
require(zetadiv)

```

## Load data from zetadiv

The zetadiv package contains an example dataset of fine scale (25 km x 25 km) bird data from BirdLife Australia on bird communties in the south-east coast of Australia. Environmental predictors include:

x: x-position in meters in UTM 53 South projection

y: y-position in meters in UTM 53 South projection

Natural: Proportion of area of conservation and natural environments

Irrigated: Proportion of area of production from irrigated agriculture and plantations

Water: Proportion of area of water features

Elevation: Elevation

ApP: Area per person

Temp: Temperature

Precip: Precipitation

Let's load these into R...

```{r load data}
data(bird.spec.fine)
xy <- bird.spec.fine[,1:2] # geographic coordinates of sites
data.spec <- bird.spec.fine[,3:192] # site-by-species matrix
data(bird.env.fine)
data.env <- bird.env.fine[,3:9] # site-by-environment matrix
```

## Zeta Decline

We can calculate the zeta decline of bird species with increasing zeta order using the following function:

```{r}
?Zeta.decline.mc()
```


```{r}
dev.new(width = 12, height = 4)
zeta.bird <- Zeta.decline.mc(data.spec, orders = 1:20, sam=100, plot = FALSE, normalize="Jaccard")
Plot.zeta.decline(zeta.bird)
```


## Zeta Decay

```{r what is zeta decay?}
?Zeta.ddecays
```

```{r}
zeta_decay2<-Zeta.ddecay(
                          xy,
                          data.spec,
                          order = 2,
                          sam = 100,
                          distance.type = "Euclidean",
                          dist.custom = NULL,
                          method = "mean",
                          reg.type = "glm",
                          family = stats::gaussian(),
                          method.glm = "glm.fit.cons",
                          cons = -1,
                          cons.inter = 1,
                          confint.level = 0.95,
                          kn = -1,
                          bs = "mpd",
                          trsf = "NULL",
                          cutoff = NULL,
                          rescale = FALSE,
                          normalize = "Jaccard",
                          empty.row = "remove",
                          plot = F
                        )

zeta_decay3<-Zeta.ddecay(
                          xy,
                          data.spec,
                          order = 3,
                          sam = 100,
                          distance.type = "Euclidean",
                          dist.custom = NULL,
                          method = "mean",
                          reg.type = "glm",
                          family = stats::gaussian(),
                          method.glm = "glm.fit.cons",
                          cons = -1,
                          cons.inter = 1,
                          confint.level = 0.95,
                          kn = -1,
                          bs = "mpd",
                          trsf = "NULL",
                          cutoff = NULL,
                          rescale = FALSE,
                          normalize = "Jaccard",
                          empty.row = "remove",
                          plot = F
                        )

zeta_decay10<-Zeta.ddecay(
                          xy,
                          data.spec,
                          order =10,
                          sam = 100,
                          distance.type = "Euclidean",
                          dist.custom = NULL,
                          method = "mean",
                          reg.type = "glm",
                          family = stats::gaussian(),
                          method.glm = "glm.fit.cons",
                          cons = -1,
                          cons.inter = 1,
                          confint.level = 0.95,
                          kn = -1,
                          bs = "mpd",
                          trsf = "NULL",
                          cutoff = NULL,
                          rescale = FALSE,
                          normalize = "Jaccard",
                          empty.row = "remove",
                          plot = F
                        )
Plot.zeta.ddecay(zeta_decay2)
Plot.zeta.ddecay(zeta_decay3)
Plot.zeta.ddecay(zeta_decay10)
```


```{r plot zeta decay}


zeta_decays<-Zeta.ddecays(
                          xy,
                          data.spec,
                          orders = 2:20,
                          sam = 100,
                          family = stats::gaussian(),
                          distance.type = "Euclidean",
                          dist.custom = NULL,
                          method = "mean",
                          confint.level = 0.95,
                          trsf = "NULL",
                          cutoff = NULL,
                          rescale = FALSE,
                          normalize = "Jaccard",
                          plot = F
                        )
Plot.zeta.ddecays(zeta_decays)
```
## Multi-Site Generalized Dissimilarity Modeling (MS-GDM)

```{r train MS-GDM and plot splines}
set.seed(1)

zeta.ispline.fine3 <-Zeta.msgdm(data.spec,data.env,xy,order=3,sam=500,reg.type="ispline",normalize="Jaccard",family=binomial(link="log"),cons.inter = -1)

zeta.ispline.fine10 <-Zeta.msgdm(data.spec,data.env,xy,order=10,sam=500,reg.type="ispline",
                                normalize="Jaccard",family=binomial(link="log"),cons.inter = -1)

zeta.ispline.r3 <- Return.ispline(zeta.ispline.fine3, data.env, distance = TRUE)
zeta.ispline.r10 <- Return.ispline(zeta.ispline.fine10, data.env, distance = TRUE)
#zeta.ispline.r


```

```{r plot splines}
#dev.new()
Plot.ispline(isplines = zeta.ispline.r3, distance = TRUE)
Plot.ispline(isplines = zeta.ispline.r10, distance = TRUE)
```
Zeta.varpart returns a data frame with one column containing the variation explained by each component 
- a (the variation explained by distance alone),
- b (the variation explained by either distance or the environment),
- c (the variation explained by the environment alone) and 
- d (the unexplained variation).

```{r}
set.seed(1)
zeta.varpart.fine3 <-Zeta.varpart(zeta.ispline.fine3,num.part = 2,reg.type = "glm",family = stats::gaussian(),method.glm = "glm.fit.cons",cons = -1,cons.inter = 1,kn = -1,bs = "mpd")

dev.new()
pie.neg(zeta.varpart.fine3[4:7,1], density = c(4, 0, 8, -1),
angle = c(90, 0, 0, 0), labels =
c("distance","distance and environment","environment","unexplained"),
radius = 0.9)

```

```{r}
set.seed(1)
zeta.varpart.fine10 <-Zeta.varpart(zeta.ispline.fine10,num.part = 2,reg.type = "glm",family = stats::gaussian(),method.glm = "glm.fit.cons",cons = -1,cons.inter = 1,kn = -1,bs = "mpd")

dev.new()
pie.neg(zeta.varpart.fine10[4:7,1], density = c(4, 0, 8, -1),
angle = c(90, 0, 0, 0), labels =
c("distance","distance and environment","environment","unexplained"),
radius = 0.9)
```



